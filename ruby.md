# Rails
## MVC (from Agile Web Development with Ruby 7-Sam Ruby)
### Definition
* model: maintain the state of the application (representation of data in the database)
* view: generate user interface for display
* controller: receive events from outside (e.g. user input), interact with model, made it available for view (software that connects views and models)
### Model
* object-relational mapping (ORM): map database tables to object-oriented classes
    * rows -> objects
    * columns -> attributes
    * table level operations (find by id) -> class methods
    * row level operations (save an object) -> instance method
* Active Record: ORM layer in rails
### Action Pack: View and Controller
* view: a chunk of HTML code that displays fixed text (put dynamic content in the controller)
* dynamic content is generated by templates (embedded ruby, ERB, is the most common)

## [Rails philosophy](https://rubyonrails.org/doctrine)
* Optimize for programmer happiness
* Convention over Configuration (most important?)
* The menu is omakase
* No one paradigm
* Exalt beautiful code
* Provide sharp knives
* Value integrated systems
* Progress over stability
* Push up a big tent
## Rails Performance (https://youtu.be/mJw3al4Ms2o?si=mPm-49XmEcl84bpx)
* monitoring
* DB (index)
* caching
## [RSpec](https://rspec.info/documentation/7.0/rspec-rails/)
* Behavior Driven Development: BDD is a process by which DSL structured natural language statements are converted to executable tests. The result are tests that read like acceptance criteria for a given function.  (wiki)
    * tests should be named in terms of desired behavior (set by the business)
    * behaviors are declarative rather than imperative (goals/results rather than steps)
    * behaviors are phrased in terms of user stories
* In RSpec, application behavior is described first in (almost) plain English, then again in test code
    *  It uses the words “describe” and “it” so we can express concepts like a conversation (https://rspec.info/features/3-13/rspec-core/example-groups/basic-structure/)
    * describe/it: The `describe` method creates an example group. Within the block passed to `describe` you can declare nested groups using the `describe` or `context` methods, or you can declare examples using the `it` or `specify` methods.
# Kamal
* Kamal is an orchestration two, in addition to handle deployment, it adds a proxy server to you application, which makes SSL easy
* check `kamal app logs -f` for your application's status and `kamal proxy logs -f" for the proxy server's status
* kamal secrets are managed in two places, the `secrete` file, which exposes env vars to kamal, and kamal config file, which actually uses those env
* port config leverage defaults
# Ruby
* Object-oriented language: allow objects to define data, functionalities and how to access these functionalities
* see `java.md` for OOP concepts
## naming
* instance variables begin with `@`
* local var, method names and params use underscore to seperate words instead of camel case
* class names, module names and constants start with an uppercase letter
* use single colon `:` to denote *symbols*: according to Programming Ruby 3.3, "Symbols aren’t exactly optimized strings, but for most purposes, you can think of them as special strings that are immutable, are only created once, and are fast to look up. Symbols are meant to be used as keys and identifiers, while strings are meant to be used for data"
## data type
* differences between single (does very little) and double quotes (look for things to process like `\n` and var `{na.capitalize}`)
## data structure
* hashmap, use symbols as keys
```
japanese_cars = {
  honda: "Accord",
  toyota: "Corolla",
  nissan: "Altima"
}
japanese_cars[:honda] 
```
## class
* class definition
```
class Greeter
  def initialize(name = "World")
    @name = name
  end
  def say_hi
    puts "Hi #{@name}"
  end
end
```
* use `attr_accessor` for set up getters and setters: `attr_accessor :name`
* class variable with `@@` eg `@@default_name = "Aki"` 
* class method with `[Classname].method_name` eg `Greeter.list_behavior`OR with `self` eg `self.list_behavior`
### inherentance
* inherentance with `<` eg `class Viking < Person`
* `super()` to evoke parent class methods

## basic syntax and methods:
* float point division: `9 /5.to_f`
* `each` method, see reference on [bloc](https://www.rubyguides.com/2016/02/ruby-procs-and-lambdas/)
```
[1,2,3].each {|n| puts n }
# or
[1,2,3].each do |n|
    puts n
end
# combine with step()
arr[0...arr.length].step(2) { |val| puts val }
```
* range function with `(1..20)` or `(1...20)`, see [here](https://www.rubyguides.com/2016/06/ruby-ranges-how-do-they-work/)
* bloc and `yield`
```
def do_something
  puts "Start of method"
  yield
  puts "End of method"
end

do_something do
  puts "Inside the block"
end
```
* module
```
module Helper
  def square(num)
    num * num
  end
end

class Calculator
  include Helper
end
```
### examples
* numbers greater than 5
```
def more_than_five(list)
  for i in list
    if i > 5
      puts i
    end
  end
end
```
* check prime number
```
def check_prime(n)
  return false if n < 2
  return true if n == 2

  (2..Math.sqrt(n)).each do |i|
    return false if n % i == 0
  end

  true
end
```
* sume prime numbers in an array
```
# simple
arr.select { |num| prime?(num) }.sum
# elaborate
def sum_prime(list)
    sum = 0
    for i in list
        if check_prime(i)
            sum += i
        end
    end
    return sum
end
```
* factorial numbers
```
def factorial(n)
  prod = 1
  (1..n).each {|n| prod *= n}
  return prod
end
```
* Fibonacci 
```
def fibonacci(n)
  return n if n <= 1  # Base cases: fib(0) = 0, fib(1) = 1
  fibonacci(n - 1) + fibonacci(n - 2)
end
# use loop
def fibonacci(n)
  return n if n <= 1  # Base cases: Fibonacci(0) = 0, Fibonacci(1) = 1

  a, b = 0, 1  # Start with first two Fibonacci numbers
  (2..n).each do
    a, b = b, a + b  # Update values
  end
  b  # Return the nth Fibonacci number
end
```
# Readings
* Securing Rails App: https://guides.rubyonrails.org/security.html
* Testing Rails App: https://guides.rubyonrails.org/testing.html
* TDD and Rspec: https://www.theodinproject.com/lessons/ruby-test-driven-development
* Tuning Performance: https://guides.rubyonrails.org/tuning_performance_for_deployment.html
* https://builders.fullscript.com/tagged/engineering
* Ruby interview questions: https://coderpad.io/interview-questions/ruby-interview-questions/
* Ruby OOP: https://eriktrautman.com/posts/ruby-explained-classes